#  Домашнее задание к занятию 3 "Резервное копирование" - Марчук Кирилл



### Задание 1
Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию /tmp/backup
Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.



1. `Создаём каталог backup`
2. `Запускаем команду rsync`
3. `Проверяем логи что всё работает корректно `



```
mkdir -p /tmp/backup
rsync -av --delete --exclude='.*' --checksum ~/ /tmp/backup/
```


![zadanie1](https://github.com/ottofonciceron-coder/Rsync-03-hw/blob/main/rsync.png)`

---

### Задание 2
Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
Резервная копия должна быть полностью зеркальной
Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
Резервная копия размещается локально, в директории /tmp/backup



1. `Создаём скрипт резервного копирования`
2. `Запускаем Скрипт`
3. `Проверяем логи`
4. `Настраиваем cron`
5. `Проверям работу и логи`


```
#Скрипт

#!/bin/bash
# Скрипт для ежедневного зеркального бэкапа домашней директории 

LOGFILE="/var/log/rsync_backup.log"
SRC="$(getent passwd "$SUDO_USER" | cut -d: -f6)"
DEST="/tmp/backup"

# Создаём каталог назначения, если его не существует 
mkdir -p "$DEST"

# Запускаем rsync с зеркалированием и проверкой хэшей
rsync -av --delete --exclude='.*' --checksum "$SRC" "$DEST" >> "$LOGFILE" 2>&1

# Проверяем код возврата rsync
if [ $? -eq 0 ]; then
    logger "RSYNC BACKUP: успешное завершение резервного копирования для пользователя $USER"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Backup completed successfully" >> "$LOGFILE"
else
    logger "RSYNC BACKUP: ошибка при резервном копировании для пользователя $USER"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Backup failed" >> "$LOGFILE"
fi

#Настраиваем cron
0 2 * * * /usr/local/bin/backup_home.sh
```

![zadanie2](https://github.com/ottofonciceron-coder/Rsync-03-hw/blob/main/rsync%20и%20cron.png)`


---
